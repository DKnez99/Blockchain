extends layout

block layout-content
    div.container-fluid
        h1.text-center.mt-4.mb-4 COINBASE AND TX TRACKING
        div.row.row-horizon(style='flex-wrap: nowrap')
            - var blocks = []
            - blocks.push({chain: 1, block: 1, magic: 74567, blockid: 1, coinvalue: '20.00', cointo: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', txs: [], prev: '0000000000000000000000000000000000000000000000000000000000000000'})
            - blocks.push({chain: 1, block: 2, magic: 74567, blockid: 2, coinvalue: '20.00', cointo: '04c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee51ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a', txs: [{value: '4.55', from: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', to: '04f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672', ref:'1.coinbase', returnedValue: '15.45', id:'1', signature:'304502200365cc106d1f92925f66f88624afb87a6dc85247d95fa4b71a3158896983bd75022100ee21947e13cb7833bd7f9db86d560dc4ae12531104af5ad36eda520c19aee51f', returnedSignature:'3046022100e9bcd71e014f4fce1046e7af8df24d75aad0829f456891aec7c7652ce1d83ede022100bba5a1e1305d512b95e17e15e6977f78e6a9cf809947bf10cac142bda2da958c'}], prev: 'd8513630308ce4132dfc271367bc3c925390ca87fb66cc6d3c109a941a833e8f'})
            - blocks.push({chain: 1, block: 3, magic: 74567, blockid: 3, coinvalue: '20.00', cointo: '04e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd1351ed993ea0d455b75642e2098ea51448d967ae33bfbdfe40cfe97bdc47739922', txs: [{value: '2.50', from: '04c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee51ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a', to: '04f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672', ref: '2', returnedValue: '17.50'}, {value: '3.00', from: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', to: '04f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672', ref: '2', returnedValue: '12.45', id:'3'}], prev: '333'})
            - blocks.push({chain: 1, block: 4, magic: 74567, blockid: 4, coinvalue: '20.00', cointo: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', txs: [{value: '4.90', from: '04f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672', to: '04c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee51ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a', ref: '2 3', returnedValue: '5.15'}, {value: '4.09', from: '04c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee51ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a', to: '042f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6', ref: '3', returnedValue: '13.41'}], prev: '44'})
            - blocks.push({chain: 1, block: 5, magic: 74567, blockid: 5, coinvalue: '20.00', cointo: '04e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd1351ed993ea0d455b75642e2098ea51448d967ae33bfbdfe40cfe97bdc47739922', txs: [{value: '1.00', from: '04e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd1351ed993ea0d455b75642e2098ea51448d967ae33bfbdfe40cfe97bdc47739922', to: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', ref: '3', returnedValue: '19.00'}, {value: '4.00', from: '042f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6', to: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', ref: '4', returnedValue: '0.09'}], prev: '55'})
            - blocks.push({chain: 1, block: 6, magic: 74567, blockid: 6, coinvalue: '10.00', cointo: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', txs: [{value: '14.50', from: '0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', to: '04c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee51ae168fea63dc339a3c58419466ceaeef7f632653266d0e1236431a950cfe52a', ref: '4 5', returnedValue: '10.50'}], prev: '222'})
            each signedandidblock in blocks
                div.col-lg-6
                    include includes/signedandidblock

    script.
        function getText(chain, block){
            var text =  $('#chain'+chain+'block'+block+'magic').val()+
                        $('#chain'+chain+'block'+block+'blockid').val()+
                        $('#chain'+chain+'block'+block+'coinvalue').val()+
                        $('#chain'+chain+'block'+block+'cointo').val();
            
            for(var i = 0; $('#chain'+chain+'block'+block+'tx'+i+'value').length>0; i++){
                text += $('#chain'+chain+'block'+block+'tx'+i+'ref').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'value').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'from').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'to').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'id').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'signature').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'returnedValue').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'returnedFrom').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'returnedTo').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'returnedId').val()+
                        $('#chain'+chain+'block'+block+'tx'+i+'returnedSignature').val();
            }
            text += $('#chain'+chain+'block'+block+'prev').val();
            return text;
        }

        function setup(chain, block){
            updateHash(chain, block);
            //magic
            $('#chain'+chain+'block'+block+'magic').bind('input propertychange', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

            $('#chain'+chain+'block'+block+'magic').bind('focusout', function() {
                if(this.value==''){
                    this.value='0';
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                }          
            });

            //blockid
            $('#chain'+chain+'block'+block+'blockid').bind('input propertychange', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

            $('#chain'+chain+'block'+block+'blockid').bind('focusout', function() {
                if(this.value==''){
                    this.value='0';
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                }          
            });

            //coinbase
            $('#chain'+chain+'block'+block+'coinvalue').bind('input propertychange', function() {
                    this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

            $('#chain'+chain+'block'+block+'coinvalue').bind('focusout', function() {
                if(this.value==''){
                    this.value='0';
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                }          
            });
            
            $('#chain'+chain+'block'+block+'cointo').bind('input propertychange', function() {
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

            //txs
            for(var i = 0; $('#chain'+chain+'block'+block+'tx'+i+'value').length>0; i++){
                //tx ref
                $('#chain'+chain+'block'+block+'tx'+i+'ref').bind('input propertychange', function() {
                    this.value = this.value.replace(/[^0-9 ]/g, '').replace(/ +/g,' ').replace(/^ /g, '');
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

                $('#chain'+chain+'block'+block+'tx'+i+'ref').bind('focusout', function() {
                    this.value = this.value.replace(/ $/g, '');
                    updateCoinbaseBlockchain(chain, block, #{blocks.length});
                });

                //tx value
                $('#chain'+chain+'block'+block+'tx'+i+'value').bind('input propertychange', function() {
                        this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');
                        updateCoinbaseBlockchain(chain, block, #{blocks.length});
                    });

                $('#chain'+chain+'block'+block+'tx'+i+'value').bind('focusout', function() {
                        if(this.value==''){
                            this.value='0';
                            updateCoinbaseBlockchain(chain, block, #{blocks.length});
                        }
                    });
                
                //tx from
                $('#chain'+chain+'block'+block+'tx'+i+'from').bind('input propertychange', function() { updateCoinbaseBlockchain(chain, block, #{blocks.length}); });

                //tx to
                $('#chain'+chain+'block'+block+'tx'+i+'to').bind('input propertychange', function() { updateCoinbaseBlockchain(chain, block, #{blocks.length}); });

                //tx returned value
                $('#chain'+chain+'block'+block+'tx'+i+'returnedValue').bind('input propertychange', function() {
                        this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');
                        updateCoinbaseBlockchain(chain, block, #{blocks.length});
                    });

                $('#chain'+chain+'block'+block+'tx'+i+'returnedValue').bind('focusout', function() {
                        if(this.value==''){
                            this.value='0';
                            updateCoinbaseBlockchain(chain, block, #{blocks.length});
                        }
                    });

                //tx returned from
                $('#chain'+chain+'block'+block+'tx'+i+'returnedFrom').bind('input propertychange', function() { updateCoinbaseBlockchain(chain, block, #{blocks.length}); });

                //tx returned to
                $('#chain'+chain+'block'+block+'tx'+i+'returnedTo').bind('input propertychange', function() { updateCoinbaseBlockchain(chain, block, #{blocks.length}); });
            }

            //prev
            $('#chain'+chain+'block'+block+'prev').bind('input propertychange', function() { updateCoinbaseBlockchain(chain, block, #{blocks.length}); });
        }

        $(function(){
            for(var i = 1; i <= #{blocks.length}; i++){
                setup(1,i);
            }
        });
        //UBACITI OBJASNJENJE KAKO RADE STVARI: SVAKI PETI COINBASE SE SMANJUJE ZA POLA, PRATE SE UNAZAD BLOKOVI ZA VALIDNE TX KROZ REFERENCE